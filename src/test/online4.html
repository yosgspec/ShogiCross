<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width" />
	<title>オンライン対戦テスト(4人用) - ShogiCross</title>
	<link rel=icon href="sample/img/favicon.min.svg">
	<link href="../shogicross.css" rel="stylesheet">
</head>
<body>
	<h1>ShogiCross オンライン対戦</h1>
	<button id="online-btn" style="margin: 20px; padding: 10px 20px; cursor: pointer; font-size: 1.2em;">オンライン対戦を始める</button>
	<div id="status"></div>
	<canvas id="online-canvas"></canvas>
	<div id="turn-status"></div>
	<p><a href=".." target="_parent">RETURN</a></p>

	<script type="module">
		import {BoardOnline} from "../ShogiCross/lib.js";
		const btn = document.getElementById("online-btn");
		const canvas = document.getElementById("online-canvas");
		const statusDiv = document.getElementById("status");
		const turnStatusDiv = document.getElementById("turn-status");

		function updateTurnStatus(board){
			turnStatusDiv.textContent =
				board.displayDeg === board.getActivePlayer().deg?
				"あなたの手番です":
				"相手の手番です";
		}

		btn.addEventListener("click", ()=>{
			btn.style.display = "none";
			statusDiv.textContent = "マッチング待機中...";

			const board = BoardOnline.run(canvas, {
				playBoard: "4人用9x9",
				useStand: true,
				playerOptions: [
					{"gameName": "将棋", "pieceSet": "p4"},
					{"gameName": "シャンチー", "pieceSet": "p4"},
					{"gameName": "チェス", "pieceSet": "p4"},
					{"gameName": "マークルック", "pieceSet": "p4"},
				],
				//serverURL: "https://shogicross-server-828297429002.asia-northeast1.run.app/",
				//serverURL: "https://shogicross-server-cs-828297429002.asia-northeast1.run.app/",
				//serverURL: "https://shogicross-server-py-828297429002.asia-northeast1.run.app/",
				onTurnEnd(board, turn){
					console.log(board.record.getText(turn, true));
					updateTurnStatus(board);
				},
				onReadyOnline(event, board){
					statusDiv.textContent = `対戦開始！ あなたはプレイヤー${event.playerId + 1}です。`;
					updateTurnStatus(board);
				},
				onCancelOnline(board){
					statusDiv.textContent = "マッチングを中止しました。";
				},
			});
		});
	</script>
</body>
</html>