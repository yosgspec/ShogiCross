<!DOCTYPE html>
<html>
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-46760069-2"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-46760069-2');
		</script>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width" />
		<title>ShogiCross</title>
		<link rel=icon href="./sample/img/favicon.min.svg">
		<link href="./shogicross.css" rel="stylesheet">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400&family=Kosugi:wght@400&family=Noto+Color+Emoji&display=swap" rel="stylesheet">
		<style>
		body, html{
			margin: 0;
			padding: 0;
			height: 100%;
		}
		#menuButton{
			display: flex;
			background-color: #6699CC;
			color: #DDEEFF;
			opacity: 0.8;
			position: fixed;
			z-index: 300;
			top: 20px;
			right: 20px;
			justify-content: center;
			align-items: center;
			width: 50px;
			height: 50px;
			border-radius: 25px;
			cursor: pointer;
		}
		#menuButton span{
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
			user-select: none;
			font-size: 35px;
		}
		#menuButton span:has(img){
			display: contents;
		}
		#menuButton span img{
			width: 40px;
			height: 40px;
		}
		menu{
			z-index: 200;
			position: fixed;
			top: 0;
			bottom: 0;
			min-width: 260px;
			max-width: 260px;
			overflow-y: auto;
			background-color: #66CCFF;
			margin: 0;
			padding: 10px;
			margin-right: 20px;
			transform: translateX(-100%);
			transition: transform 0.3s;
		}
		menu.open{
			transform: translateX(0);
		}
		main{
			width: 100%;
			overflow-y: auto;
			padding: 0;
			margin-left: 0;
			transition: margin-left 0.3s;
		}
		#menuButton:has(+ menu.load-menu),
		menu.load-menu{
			display: none;
		}
		iframe{
			width: 100%;
			height: 600px;
			margin: 0;
		}
		table, td, th{
			border: 1px #000099 solid;
		}
		@media(min-width: 800px){
			main{
				margin-left: 10px;
			}
			menu.open + main{
				margin-left: 290px;
			}
			#menuButton{
				top: calc(50% - 25px);
				left: -25px;
				transition: left 0.3s;
			}
			#menuButton:has(+ menu.open){
				left: 250px;
			}
		}
		</style>
	</head>
	<body>
		<div class="flex-row" style="flex-wrap:nowrap; height:100%;">
			<div id="menuButton"><span></span></div>
			<menu class="load-menu">
				<a href="#"><img src="./sample/img/logo.min.svg" style="width:90%;"></a>
				<div id="menuList" class="flex-col"></div>
			</menu>
			<main></main>
		</div>

		<script type="module">
		import menuHtml from "./menu.js";
		const endTitle = " - ShogiCross";
		const menu = document.querySelector("menu");
		const menuList = menu.querySelector("#menuList");
		const menuButton = document.getElementById("menuButton");
		const menuButtonText = menuButton.firstElementChild;
		menuList.innerHTML = menuHtml;

		let icons = [];
		const switchMenu = function(){
			let isOpen = true;

			return setIsOpen=>{
				isOpen = typeof(setIsOpen) === "boolean"? setIsOpen: !isOpen;
				const icon = icons[0|isOpen];
				menu.classList.toggle("open", isOpen);
				menuButtonText.innerHTML = icon;
			};
		}();

		function setupMenu(){
			const isDesktopView = 800 <= window.innerWidth;
			icons = isDesktopView?
				["▶", "◀"]:
				[
					`<img src="./sample/img/favicon.min.svg" alt="menu close">`,
					`<img src="./sample/img/faviconBlack.min.svg" alt="menu open">`
				];
			switchMenu(isDesktopView);
		}

		async function router(){
			const main = document.querySelector("main");
			const vMain = main.cloneNode(false);
			const hash = location.hash !== ""? location.hash.slice(1): "index";

			let res = await fetch(`./pages/${hash}.html`);
			if(!res.ok) res = await fetch("./pages/index.html");
			const mainHtml = await res.text();
			vMain.innerHTML = mainHtml;
			const h1 = vMain.querySelector("h1");
			if(h1) h1.textContent +=  endTitle;
			document.title = (
				document.querySelector(`a[href="#${hash}"`)?.textContent ?? "将棋クロス")
				+ endTitle;
			main.replaceWith(vMain);
			setupMenu();
			menu.classList.toggle("load-menu", false);
		}

		menuButton.onclick = switchMenu;
		window.onresize = setupMenu
		window.onhashchange = router;
		router();
	</script>
	</body>
</html>
