<html>
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-46760069-2"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-46760069-2');
		</script>

		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width" />
		<title>CrossOverChess</title>
		<link rel=icon href="../favicon.ico">
		<link href="../gspec20.css" rel="stylesheet">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Kosugi&family=Noto+Serif+JP:wght@900&family=Noto+Serif+TC:wght@900&family=Noto+Serif:wght@900&display=swap" rel="stylesheet">
		<style>
			body {
				font-family:"Noto Serif JP","Noto Serif",serif;
				font-weight: 900;
				line-height: 1.3em;
			}
			input, select, option, textarea {
				font-family:"Noto Serif JP","Noto Serif",serif;
				line-height: 1em;
			}
		</style>
	</head>
	<body>
		<h1>CrossOverChess</h1>
		<div>
			<div style="float:left;">
				<canvas id="crossChess"></canvas>
			</div>
			<div>
				<div><select id="selectGame"></select></div>
				<div><textarea id="crossChessText"></textarea></div>
				<div><textarea id="crossChessTextMini"></textarea></div>
			</div>
		</div>
		<div>
			<br>
			<div><a href="./pieceViewer.html">PieceViewer</a></div>
			<div><a href="https://github.com/yosgspec/CrossChess">GitHub</a></div>
			<div><a href="/">トップメニュー</a></div>
		</div>

		<script src="./json/games.json.js"></script>
		<script src="./json/pieces.json.js"></script>
		<script src="./json/pieceCost.json.js"></script>
		<script src="./json/panels.json.js"></script>
		<script src="./json/boards.json.js"></script>
		<script src="./json/canvasFont.json.js"></script>
		<script src="./core/extendCanvasFonts.js"></script>
		<script src="./core/uiControl.js"></script>
		<script src="./core/checkTarget.js"></script>
		<script src="./core/board.js"></script>
		<script src="./core/panel.js"></script>
		<script src="./core/stand.js"></script>
		<script src="./core/piece.js"></script>
		<script src="./game/playGame.js"></script>
		<script>
			// リストボックスに追加
			const selectGame = document.getElementById("selectGame");
			Object.entries(PlayGame).forEach(([key, {name}])=>{
				const opt = document.createElement("option");
				opt.value = key;
				opt.textContent = name;
				selectGame.appendChild(opt);
			});

			// ゲームを実行
			let playingGame;
			const playGame = async function(){
				playingGame?.close();

				await canvasFont.import();
				const canvas = document.getElementById("crossChess");
				const txt = document.getElementById("crossChessText");
				const txtMini = document.getElementById("crossChessTextMini");
				const textInput = document.getElementById("crossChessTextInput");
				const onDrawed = e=>{
					txt.value = ""+e;
					const txtSplit = txt.value.split(/\n/);
					const fontSize = parseFloat(window.getComputedStyle(txt, null).getPropertyValue('font-size'));
					txt.style.width = fontSize*txtSplit[0].length*1.15;
					txt.style.height = fontSize*txtSplit.length*1.1;
					txtMini.value = e.toString(true);
					const txtMiniSplit = txtMini.value.split(/\n/);
					txtMini.style.width = fontSize*txtMiniSplit[0].length*1.2;
					txtMini.style.height = fontSize*txtMiniSplit.length*1.2;
				};
				playingGame = PlayGame[selectGame.value].run(canvas, onDrawed);
				const onChange =e=>{
					playingGame.inputPieces(e.target.value);
				};
				txt.onchange = onChange;
				txtMini.onchange = onChange;
			};
			playGame();
			selectGame.addEventListener("change", playGame);
		</script>
	</body>
</html>
